(function() {
  var $modal = $("#order-preview-modal");
  if ($modal.length > 0) {
    $modal.remove();
  }

  $modal = $('<%= j(render partial: "preview_modal").strip.html_safe %>');
  $("body").append($modal);

  let dialog = new window.Decidim.Dialogs("#order-preview-modal");
  $modal.data("orderPreviewDialog", dialog);
  let dialogInstance = $modal.data("orderPreviewDialog");

  dialogInstance.open();

  document.body.classList.remove("loading");

  // Prevent accidential double submission of the form
  $("button[type='submit']", $modal).on("click", function() {
    setTimeout(function() {
      $(".buttons button", $modal).attr("disabled", true);
      document.body.classList.add("loading");
    }, 50);
  });
})();
